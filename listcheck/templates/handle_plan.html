{% extends 'base_proj.html' %}

{% block page_title %}处理上架计划{% endblock %}

{% block content_title %}处理上架计划{% endblock %}

{% block main_content %}
<div class="row">
	<div class="col-md-12">
		<table class="table table-hover">
			<thead>
				<th>申请人</th>
				<th>申请店铺</th>
				<th>提交时间</th>
				<th>备注</th>
				<th>操作</th>
			</thead>
			<tbody>
			{% for plan in plans%}
				<tr>
					<td>{{plan.poster}}</td>
					<td>{{plan.planed_account}}</td>
					<td>{{plan.uploadtime|date:"Y-m-d H:i:s T" }}</td>
					<td>{%if plan.note == None%}{%elif plan.note != None%}{{plan.note}}{%else%}{{plan.note}}{%endif%}
					</td>
					<td>
						{% if plan.check_result != 'true'%}
						<button class="btn btn-primary btn-sm" id="btnpass" value="{{plan.id}}">通过</button>
						{%else%}
						<button disabled class="btn btn-success btn-sm" id="btnpass" value="{{plan.id}}">已通过</button>
						{% endif %} <a class="btn btn-info btn-sm" href="/listcheck/detail/id={{plan.id}}">查看</a> <button class="btn btn-default btn-sm" href="javascript:void(0);" data-toggle="modal" data-target="#notemodal{{plan.id}}">备注</button>
<div class="row">
	<div class="modal fade" id="notemodal{{plan.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<form action="/listcheck/fake_ajax/add_note/id={{plan.id}}" method="post">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"  aria-hidden="true">×</button>
						<h4 class="modal-title" id="myModalLabel">填写备注</h4>
					</div>
					<div class="modal-body">
						<textarea name="note" class="form-control" style="resize:none;height: 200px;"></textarea>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default"  data-dismiss="modal">关闭</button>
						<button type="submit" class="btn btn-primary">提交更改</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
					</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
</div>
<div class="row">
	<div style="width:100%;text-align:center;">
		<ul class="pagination">
			{% if plans.has_previous %}
			<li><a class='paginator' title='上一页' href='page={{ plans.previous_page_number }}'><span>&lt;&lt;</span></a>
			</li>
			{% endif %}
			{% for page in plans.paginator.page_range %}
				{% if page = plans.number %}
				<li><a  class="active" href="javascript:void(0);">{{ page }}</a></li>
				{% else %}
				<li><a href="page={{ page }}">{{ page }}</a></li>
				{% endif %}
			{% endfor %}
			{% if plans.has_next %}
			<li><a href="page={{ plans.next_page_number }}">&raquo;</a></li>
			{% endif %}
		</ul>
	</div>
</div>

{% endblock %}

{% block page_level_scripts %}
<script type="text/javascript">
/* mark as passed via ajax */
$("button[id='btnpass']").each(function (index) {
	$(this).click(function(){
		if (confirm("是否确认通过?")) { /* confirm to delete a user*/
			var value = $(this).attr('value');
			$.post(
				'/listcheck/ajax/mark_passed.html',
				{'listplan_id': value},
				function(data){
					alert('刷新页面中');
					window.location.reload();
				}
				);
		} else { return false };
	});
});
</script>
{% endblock %}